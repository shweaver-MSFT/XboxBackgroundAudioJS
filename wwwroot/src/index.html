<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hybrid Web Application</title>

    <link href="css/global.css" rel="stylesheet">
</head>
<body>
    <div class="contentRoot">
        <button id="playButton">Play</button>
        <button id="pauseButton">Pause</button>
    </div>

    <!-- Include scripts at the end, for perf. -->
    <script src="js/logger.js"></script>
    <script src="js/app.js"></script>
    <script src="js/activation.js"></script>
    <script>
        (function () {

            var logger = document.logger;

            /* Main ViewModel */
            var viewModel = new function () {

                let Uri = Windows.Foundation.Uri;
                let MediaSource = Windows.Media.Core.MediaSource;
                let MediaPlayer = Windows.Media.Playback.MediaPlayer;
                let SystemMediaTransportControlsButton = Windows.Media.SystemMediaTransportControlsButton;

                var _mediaPlayer = null;
                var _systemMediaTransportControls = null;

                /**
                 * Initialize the ViewModel.
                 */
                this.InitializeAsync = async function () {
                    logger.Log("Main ViewModel Initializing...");

                    let source = MediaSource.createFromUri(new Uri("ms-appx:///assets/Ring01.wma"));

                    _mediaPlayer = new MediaPlayer();
                    _mediaPlayer.source = source;
                    _mediaPlayer.autoPlay = true;
                    _mediaPlayer.isLoopingEnabled = true;

                    _systemMediaTransportControls = _mediaPlayer.systemMediaTransportControls;
                    _systemMediaTransportControls.isPlayEnabled = true;
                    _systemMediaTransportControls.isPauseEnabled = true;
                    _systemMediaTransportControls.addEventListener("buttonpressed", SystemMediaTransportControls_ButtonPressed.bind(this));

                    _mediaPlayer.play();

                    logger.Log("Main ViewModel Initialized");
                };

                this.Play = function () {
                    _mediaPlayer.play();
                };

                this.Pause = function () {
                    _mediaPlayer.pause();
                };

                function SystemMediaTransportControls_ButtonPressed(args) {
                    var button = args.detail[0].button;

                    switch (button) {
                        case SystemMediaTransportControlsButton.play:
                            this.Play();
                            break;
                        case SystemMediaTransportControlsButton.pause:
                            this.Pause();
                            break;
                    }
                }
            };

            /* Main View */
            var view = new function () {

                // Init View
                logger.Log("Main View Initializing...");

                // Init ViewModel
                viewModel.InitializeAsync();

                var playButton = document.querySelector("#playButton");
                playButton.addEventListener("click", function () {
                    viewModel.Play();
                });

                var pauseButton = document.querySelector("#pauseButton");
                pauseButton.addEventListener("click", function () {
                    viewModel.Pause();
                });

                logger.Log("Main View Initialized");
            }();
        })();
    </script>
</body>
</html>
